<div class="chat-page-container" [class.mobile-view]="isMobile">
  <!-- Error Message -->
  <div *ngIf="hasError" class="error-banner">
    <span>⚠️ {{ errorMessage }}</span>
    <button (click)="errorMessage = ''" class="close-error">×</button>
  </div>

  <!-- Mobile Header -->
  <div class="mobile-header" *ngIf="isMobile">
    <div class="header-content">
      <button *ngIf="!showSessions" class="back-button" (click)="onBackToSessions()">
        ← Oturumlar
      </button>
      <h1>{{ showSessions ? 'Sohbet Oturumları' : getCurrentSessionTitle() }}</h1>
      <div *ngIf="isLoading" class="loading-spinner">
        <div class="spinner"></div>
      </div>
    </div>
  </div>

  <!-- Sessions Panel -->
  <div class="chat-sessions" 
       [class.mobile-hidden]="isMobile && !showSessions"
       [class.mobile-visible]="isMobile && showSessions">
    
    <div *ngIf="isLoadingSessions" class="loading-overlay">
      <div class="loading-content">
        <div class="spinner large"></div>
        <p>Oturumlar yükleniyor...</p>
      </div>
    </div>

    <app-chat-session
      [sessions]="sessions"
      [activeSessionId]="currentSessionId"
      (sessionSelected)="onSessionSelected($event)"
      (newSession)="onNewSession()">
    </app-chat-session>
  </div>

  <!-- Messages Panel -->
  <div class="chat-messages"
       [class.mobile-hidden]="isMobile && showSessions"
       [class.mobile-visible]="isMobile && !showSessions">
    
    <!-- Simple Message Header (Desktop only) -->
    <div *ngIf="currentSessionId && !isMobile" class="message-header">
      <div class="header-info">
        <h3>{{ getCurrentSessionTitle() }}</h3>
        <div class="message-stats">
          <span>📊 {{ messageStats.total }}</span>
          <span>👤 {{ messageStats.user }}</span>
          <span>🤖 {{ messageStats.ai }}</span>
        </div>
      </div>
      <button class="refresh-btn" (click)="onRefreshMessages()">🔄</button>
    </div>
    
    <div *ngIf="isLoadingMessages" class="loading-overlay">
      <div class="loading-content">
        <div class="spinner large"></div>
        <p>Mesajlar yükleniyor...</p>
      </div>
    </div>

    <!-- No Session Selected -->
    <div *ngIf="!currentSessionId && !isLoadingMessages" class="no-session-selected">
      <div class="no-session-content">
        <div class="no-session-icon">💬</div>
        <h3>Sohbet Seçin</h3>
        <p>Başlamak için sol panelden bir sohbet seçin veya yeni bir sohbet oluşturun.</p>
      </div>
    </div>

    <!-- Messages Container -->
    <div *ngIf="currentSessionId" class="messages-container">
      <app-chat-messages
        [messages]="messages"
        [currentSessionId]="currentSessionId"
        [isLoading]="isWaitingForAIResponse"
        (sendMessage)="onSendMessage($event)">
      </app-chat-messages>

      <!-- Load More Button -->
      <div *ngIf="canLoadMore" class="load-more-container">
        <button (click)="onLoadMoreMessages()" class="load-more-btn" [disabled]="isLoadingMessages">
          <span *ngIf="!isLoadingMessages">📄 Daha Fazla Mesaj</span>
          <span *ngIf="isLoadingMessages">
            <div class="spinner small"></div>
            Yükleniyor...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
